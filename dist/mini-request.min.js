!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).appletsRequest={})}(this,(function(t){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var e=function(){return(e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function r(t,e,r,n){return new(r||(r=Promise))((function(o,i){function u(t){try{s(n.next(t))}catch(t){i(t)}}function a(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(u,a)}s((n=n.apply(t,e||[])).next())}))}function n(t,e){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var o=function(){function t(t){this.message="",this.isCancel=!0,this.message=t}return t.prototype.toString=function(){return"Cancel: "+(this.message||"")},t}(),i=function(){function t(t){var e=this;this.promiseResolve=function(){},this.promise=new Promise((function(t){e.promiseResolve=t})),"function"==typeof t&&t(this.cancel.bind(this))}return t.source=function(){var e=function(){};return{token:new t((function(t){e=t})),cancel:e}},t.prototype.cancel=function(t){this.reason||(this.reason=new o(t),this.promiseResolve(this.reason))},t.prototype.execAbort=function(t){return this.promise.then(t)},t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t}();function u(t){return Object.prototype.toString.call(t)}function a(t){if(null===t||"[object Object]"!==u(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function s(t){return void 0===t}function c(t,e){if(null!=t){var r=t;"object"!=typeof t&&(r=[t]),Array.isArray(r)?r.forEach((function(r,n){e.call(null,r,n,t)})):Object.keys(r).forEach((function(t){e.call(null,r[t],t,r)}))}}function f(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return Object.create(null);var r=Object.create(null);function n(t,e){a(r[e])&&a(t)?r[e]=f(r[e],t):a(t)?r[e]=f({},t):Array.isArray(t)?r[e]=f(t):r[e]=t}return r=Array.isArray(t[0])?[]:Object.create(null),t.forEach((function(t){c(t,n)})),r}function p(t){return"string"==typeof t}function l(t){return"function"==typeof t}function h(t){return!s(t)&&(t&&t.isCancel)}function d(t){function r(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(e){return t}}return new Promise((function(n,o){var i,u,a=t.Adapter,c=function(t){var e={url:t.url||"",method:t.method,data:t.data,header:t.headers,dataType:"json",timeout:t.timeout},r=t.dataType||"json";return e.dataType=r,t.responseType&&"json"!==t.responseType&&(e.dataType="其他"),e}(t),p=((u=f({},i=c)).headers=i.header,delete u.header,delete u.Adapter,u);if(!a)throw new TypeError("Adapter is undefined or null");var l=new a(p),h=wx.request(e(e({},c),{success:function(t){l.resolve(function(t){return s(t)||null===t?{headers:{},status:200,data:{},response:t}:{headers:t.header,status:t.statusCode,data:r(t.data),response:t}}(t),n)},fail:function(t){var e=function(t,e){return t&&(t.errMsg||"").toString().toLowerCase().includes("timeout")?{msg:"Timeout of "+(e||"")+" ms exceeded",type:"TIMEOUT"}:{msg:"Network Error",type:"NETWORK_ERROR"}}(t,c.timeout),r={errMsg:e.msg,status:e.type,extra:t};l.reject(r,o)},complete:function(){h=null}}));l.cancel((function(t){o(t),h.abort(),h=null})),"function"==typeof t.getRequestTask&&t.getRequestTask(h)}))}function y(t,e){e&&c(t,(function(r,n){n!==e&&n.toUpperCase()===e.toUpperCase()&&(t[e]=r,delete t[n])}))}var g,v={adapter:!s(wx)&&l(wx.request)?d:Promise.resolve,method:"GET",timeout:1e4,headers:e({common:{Accept:"application/json, text/plain, */*"}},(g={},["delete","get","head","options"].forEach((function(t){g[t]={}})),["post","put","patch"].forEach((function(t){g[t]={"Content-Type":"application/x-www-form-urlencoded"}})),g)),transformConfig:[],transformRequest:[function(t,e){return y(e,"Accept"),y(e,"Content-Type"),a(t)&&function(t,e){!s(t)&&t&&s(t["Content-Type"])&&(t["Content-Type"]=e)}(e,"application/json; charset=utf-8"),t}],transformResponse:[],xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",validateStatus:function(t){return t>=200&&t<300}};function m(t){return!s(t)&&null!==t&&"NETWORK_ERROR"===t.status}function b(t){return!s(t)&&null!==t&&"TIMEOUT"===t.status}function T(t,e){var r=t||"",n=e||"";return n?r.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):r}function C(t){return/^([a-z][a-z\d+-.]*:)?\/\//i.test(t||"")}function R(t,e,r){var n=E(t);if("string"==typeof e)return w(n,e);var o,i=Object.keys(null===(o=e)||"object"!=typeof o?{}:e);if(0===i.length&&!l(r))return n;var s=l(r)?null==r?void 0:r(e):function(t,e){var r=t.filter((function(t){return function(t){if(null==t)return!1;return!0}(e[t])})).map((function(t){return function(t,e){if(Array.isArray(e))return function(t,e){var r=e.map((function(e,r){return 0===r?e:j(t+"[]")+"="+j(e)}));return[j(t+"[]"),r.join("&")]}(t,e);if(function(t){return"[object Date]"===u(t)}(e))return[j(t),j(e.toISOString())];if(a(e))return[j(t),j(JSON.stringify(e))];return[t,e]}(t,e[t])}));if(0===r.length)return"";return r.reduce((function(t,e){return e[0]&&e[1]?(t?t+"&":"")+e.join("="):t}),"")}(i,e);return s?w(n,s):n}function w(t,e){return t.includes("?")?t+"&"+e:t+"?"+e}function E(t){return t.includes("#")?t.slice(0,t.indexOf("#")):t}function j(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function O(t,e,r){return t?R(t,e,r):E(t)}var q=function(){function t(){this.interceptors=[]}return t.prototype.use=function(t,e){return this.interceptors.push({fulfilled:t,rejected:e}),this.interceptors.length-1},t.prototype.eject=function(t){this.interceptors[t]&&(this.interceptors[t]=null)},t.prototype.forEach=function(t){this.interceptors.forEach((function(e){"function"==typeof t&&null!==e&&t(e)}))},t}();function x(t,e){var r=e||{},n=Object.create(null),o=["url","method","data"],i=["headers","params"],u=["validateStatus"];function p(e){var o=t[e],i=r[e];s(i)?s(o)||(n[e]=l(void 0,o)):n[e]=l(o,i)}function l(t,e){return a(t)&&a(e)?f(t,e):a(e)?f({},e):h(e)}function h(t){return Array.isArray(t)||a(t)?f(t):t}o.forEach((function(t){var e=r[t];if(s(e))return;n[t]=h(e)})),["baseURL","transformConfig","transformRequest","transformResponse","paramsSerializer","timeout","adapter","responseType","xsrfCookieName","xsrfHeaderName","cancelToken"].forEach((function(e){var o=r[e];if(!s(o))return void(n[e]=h(o));s(t[e])||(n[e]=h(t[e]))})),u.forEach((function(e){if(e in r)return void(n[e]=h(r[e]));e in t&&(n[e]=h(t[e]))})),i.forEach(p);var d=o.concat(i).concat(u).concat(i);return c(Object.keys(t).concat(Object.keys(r)).filter((function(t){return!d.includes(t)})),p),n}var k="miniRequest:cookies";function S(t){try{var e=wx.getStorageSync(k);return e&&t&&p(e[t])?e[t]:""}catch(t){return console.error(t),""}}function A(t,e){var r={};if(!a(t))return r;if(0===e.length)return t;var n={};return e.forEach((function(t){n[t.toUpperCase()]=t})),Object.keys(t).forEach((function(e){var o=e.toUpperCase(),i=n[o];r[i||e]=t[e]})),r}function N(t,e){if(!t)return{};var r=f(t.common,t[e.toLowerCase()],t);return["delete","get","post","head","patch","put","options","common"].forEach((function(t){delete r[t]})),r}function M(t,e){return e||"0"===String(e)?t+"="+e:t}function P(t,e){var r=t;return c(e,(function(e){"function"==typeof e&&(r=e(t))})),function(t){return t?Array.isArray(t)?f([],t):f({},t):{}}(r)}function U(t,e,r){var n=t;return c(r,(function(r){"function"==typeof r&&(n=r(t,e))})),n}var W=decodeURIComponent,I=/; */;function D(t,e){return void 0===e&&(e={}),t?function(t,e){void 0===e&&(e={});if("string"!=typeof t)return{};var r={},n=t.split(I),o=e.decode||W;return n.forEach((function(t){var e=t.indexOf("=");if(!(e<0)){var n=t.substr(0,e).trim(),i=t.substr(e+1,t.length).trim();'"'===i[0]&&(i=i.slice(1,-1)),s(r[n])&&(r[n]=function(t,e){try{return e(t)}catch(e){return t}}(i,o))}})),r}(t,e):{}}var K=function(t,e,r,n,o){this.extra=null,this.errMsg=t,this.config=e,this.status=r,this.response=n,this.extra=o};function L(t,e,r,n,o){return new K(t,e,r||0===r?r:"NETWORK_ERROR",n,o)}var _=function(){function t(t){this.reqConfig=t}return t.prototype.resolve=function(t,e){(s(t)||null===t)&&e({headers:{},status:200,data:{},config:this.reqConfig,originalRes:null}),e({headers:t.headers,config:this.reqConfig,data:t.data,status:t.status,originalRes:s(t.response)?null:t.response})},t.prototype.reject=function(t,e){(s(t)||null===t)&&e({status:"NETWORK_ERROR",errMsg:"Reject arguments Error",config:this.reqConfig,extra:null}),e({config:this.reqConfig,status:t.status,data:t.data,errMsg:t.errMsg,extra:s(t.extra)?null:t.extra})},t.prototype.cancel=function(t){this.reqConfig.cancelToken&&this.reqConfig.cancelToken.execAbort((function(e){t(e)}))},t}();function z(t){return r(this,void 0,void 0,(function(){var r,o,i,u;return n(this,(function(n){switch(n.label){case 0:r=function(t){G(t);var r=t.baseURL,n=t.url,o=t.params,i=O(C(n)?n:T(r,n),o,t.paramsSerializer),u=function(t){return t&&"string"==typeof t?t.toUpperCase():"GET"}(t.method),s=e(e({},t),{headers:N(t.headers,u)});s.data=U(s.data,s.headers,s.transformRequest),s.headers=function(t,e){var r=A(Object.assign(t||{}),["Content-Type"]);return a(e)&&!r["Content-Type"]&&(r["Content-Type"]="application/json; charset=utf-8"),null==e&&delete r["Content-Type"],r}(s.headers,s.data);var c=function(t){return t.withCredentials,function(t,e){if(!e&&String(e)!==String(0))return t;var r=S(e);return p(t)?t+"; "+M(e,r):r||"0"===String(r)?""+M(e,r):e}(t.headers.Cookies,t.xsrfCookieName);return""}(s=P(s,t.transformConfig));c&&(s.headers.Cookies=c);var f=S(s.xsrfCookieName);f&&(s.headers[s.xsrfHeaderName]=f);return e(e({},s),{url:i,method:u,headers:s.headers,getRequestTask:H(s.getRequestTask),Adapter:_})}(t),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,t.adapter(r)];case 2:return o=n.sent(),G(r),a(o.headers)&&(o.cookies=D(A(o.headers,["Set-Cookie"])["Set-Cookie"])),t.autoCookies&&function(t){if(t&&a(t))try{var e=wx.getStorageSync(k);wx.setStorageSync(k,f(e,t))}catch(t){console.error(t)}}(o.cookies),"function"==typeof t.validateStatus&&t.validateStatus(o.status)?(o.data=U(o.data,o.headers,r.transformResponse),[2,o]):[2,Promise.reject(L("Request failed with status code "+o.status,o.config,o.status,o))];case 3:return h(i=n.sent())?[2,Promise.reject(i)]:(G(r),(u=i)&&u.response&&(u.response.data=U(u.response.data,u.response.headers,r.transformResponse)),[2,Promise.reject(L(u.errMsg,u.config,u.status,u.response,u.extra))]);case 4:return[2]}}))}))}function G(t){t.cancelToken&&t.cancelToken.throwIfRequested()}function H(t){return"function"==typeof t?t:function(){}}var X=function(){function t(e){this.AppletsRequest=t,this.CancelToken=i,this.isCancel=h,this.defaults={},this.isTimeout=b,this.isNetworkError=m,e&&(this.defaults=e),this.interceptors={request:new q,response:new q}}return t.prototype.request=function(t,e){var r={};"string"==typeof t?(r=this.transformConfig(e)).url=t:r=t,r=x(this.defaults,r);var n=[{fulfilled:z,rejected:void 0}];this.interceptors.request.forEach((function(t){return n.unshift(t)})),this.interceptors.response.forEach((function(t){return n.push(t)}));var o=Promise.resolve(r);return n.forEach((function(t){t&&(o=o.then(t.fulfilled,t.rejected))})),o},t.prototype.get=function(t,e){return this.requestWithMethod(t,"GET",e)},t.prototype.delete=function(t,e){return this.requestWithMethod(t,"DELETE",e)},t.prototype.head=function(t,e){return this.requestWithMethod(t,"HEAD",e)},t.prototype.options=function(t,e){return this.requestWithMethod(t,"OPTIONS",e)},t.prototype.post=function(t,e,r){return this.requestWithData(t,"POST",e,r)},t.prototype.put=function(t,e,r){return this.requestWithData(t,"PUT",e,r)},t.prototype.create=function(e){var r=new t(x(v,e));return function(t,e){if(p(e))return t;for(var r in e)t[r]=e[r];return t}(t.prototype.request.bind(r),r)},t.prototype.all=function(t){if(0===t.length)throw new TypeError("arguments length is 0");return Promise.all(t)},t.prototype.getUri=function(t){var e=t.url,r=t.baseURL,n=t.params,o=e||"";return O(C(o)?o:T(r||"",o),n,t.paramsSerializer)},t.prototype.requestWithMethod=function(t,r,n){return this.request(e(e({},this.transformConfig(n)),{url:t,method:r}))},t.prototype.requestWithData=function(t,r,n,o){return this.requestWithMethod(t,r,e(e({},this.transformConfig(o)),{data:n}))},t.prototype.transformConfig=function(t){return a(t)?t:{}},t}();function F(t){return new X(t).create(t)}var J=F();t.AppletsRequest=X,t.createAppletsRequestInstance=F,t.default=J,Object.defineProperty(t,"__esModule",{value:!0})}));//# sourceMappingURL=mini-request.min.js.map
