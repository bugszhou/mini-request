!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).appletsRequest={})}(this,(function(t){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function n(t,e,n,r){return new(n||(n=Promise))((function(o,i){function u(t){try{a(r.next(t))}catch(t){i(t)}}function s(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,s)}a((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var o=function(){function t(t){this.message="",this.isCancel=!0,this.message=t}return t.prototype.toString=function(){return"Cancel: "+(this.message||"")},t}(),i=function(){function t(t){var e=this;this.promiseResolve=function(){},this.promise=new Promise((function(t){e.promiseResolve=t})),"function"==typeof t&&t(this.cancel.bind(this))}return t.source=function(){var e=function(){};return{token:new t((function(t){e=t})),cancel:e}},t.prototype.cancel=function(t){this.reason||(this.reason=new o(t),this.promiseResolve(this.reason))},t.prototype.execAbort=function(t){return this.promise.then(t)},t.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},t}();function u(t){return Object.prototype.toString.call(t)}function s(t){if(null===t||"[object Object]"!==u(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}function a(t){return void 0===t}function c(t,e){if(null!=t){var n=t;"object"!=typeof t&&(n=[t]),Array.isArray(n)?n.forEach((function(n,r){e.call(null,n,r,t)})):Object.keys(n).forEach((function(t){e.call(null,n[t],t,n)}))}}function f(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return Object.create(null);var n=Object.create(null);function r(t,e){s(n[e])&&s(t)?n[e]=f(n[e],t):s(t)?n[e]=f({},t):Array.isArray(t)?n[e]=f(t):n[e]=t}return n=Array.isArray(t[0])?[]:Object.create(null),t.forEach((function(t){c(t,r)})),n}function l(t){return"string"==typeof t}function p(t){return"function"==typeof t}function h(t){return!a(t)&&(t&&t.isCancel)}var d=function(){function t(t){this.reqConfig=t}return t.prototype.resolve=function(t,e){(a(t)||null===t)&&e({headers:{},status:200,data:{},config:this.reqConfig,originalRes:null}),e({headers:t.headers,config:this.reqConfig,data:t.data,status:t.status,originalRes:a(t.response)?null:t.response})},t.prototype.reject=function(t,e){(a(t)||null===t)&&e({status:"NETWORK_ERROR",errMsg:"Reject arguments Error",config:this.reqConfig,extra:null}),e({config:this.reqConfig,status:t.status,data:t.data,errMsg:t.errMsg,extra:a(t.extra)?null:t.extra})},t.prototype.cancel=function(t){this.reqConfig.cancelToken&&this.reqConfig.cancelToken.execAbort((function(e){t(e)}))},t}();function y(t){function n(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(e){return t}}return new Promise((function(r,o){var i=function(t){var e={url:t.url||"",method:t.method,data:t.data,header:t.headers,dataType:"json",timeout:t.timeout},n=t.dataType||"json";return e.dataType=n,t.responseType&&"json"!==t.responseType&&(e.dataType="其他"),e}(t),u=new d(function(t){if(a(t)||null===t)return{};var e=f({},t);return e.headers=t.header,delete e.header,e}(i)),s=wx.request(e(e({},i),{success:function(t){u.resolve(function(t){return a(t)||null===t?{headers:{},status:200,data:{},response:t}:{headers:t.header,status:t.statusCode,data:n(t.data),response:t}}(t),r)},fail:function(t){var e=function(t,e){return t&&(t.errMsg||"").toString().toLowerCase().includes("timeout")?{msg:"Timeout of "+(e||"")+" ms exceeded",type:"TIMEOUT"}:{msg:"Network Error",type:"NETWORK_ERROR"}}(t,i.timeout),n={errMsg:e.msg,status:e.type,extra:t};u.reject(n,o)},complete:function(){s=null}}));u.cancel((function(t){o(t),s.abort(),s=null})),"function"==typeof t.getRequestTask&&t.getRequestTask(s)}))}function g(t,e){e&&c(t,(function(n,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[r])}))}var v,m={adapter:!a(wx)&&p(wx.request)?y:Promise.resolve,method:"GET",timeout:1e4,headers:e({common:{Accept:"application/json, text/plain, */*"}},(v={},["delete","get","head","options"].forEach((function(t){v[t]={}})),["post","put","patch"].forEach((function(t){v[t]={"Content-Type":"application/x-www-form-urlencoded"}})),v)),transformConfig:[],transformRequest:[function(t,e){return g(e,"Accept"),g(e,"Content-Type"),s(t)&&function(t,e){!a(t)&&t&&a(t["Content-Type"])&&(t["Content-Type"]=e)}(e,"application/json; charset=utf-8"),t}],transformResponse:[],xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",validateStatus:function(t){return t>=200&&t<300}};function b(t){return!a(t)&&null!==t&&"NETWORK_ERROR"===t.status}function C(t){return!a(t)&&null!==t&&"TIMEOUT"===t.status}function R(t,e){var n=t||"",r=e||"";return r?n.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):n}function T(t){return/^([a-z][a-z\d+-.]*:)?\/\//i.test(t||"")}function w(t,e,n){var r=j(t);if("string"==typeof e)return E(r,e);var o,i=Object.keys(null===(o=e)||"object"!=typeof o?{}:e);if(0===i.length&&!p(n))return r;var a=p(n)?null==n?void 0:n(e):function(t,e){var n=t.filter((function(t){return function(t){if(null==t)return!1;return!0}(e[t])})).map((function(t){return function(t,e){if(Array.isArray(e))return function(t,e){var n=e.map((function(e,n){return 0===n?e:O(t+"[]")+"="+O(e)}));return[O(t+"[]"),n.join("&")]}(t,e);if(function(t){return"[object Date]"===u(t)}(e))return[O(t),O(e.toISOString())];if(s(e))return[O(t),O(JSON.stringify(e))];return[t,e]}(t,e[t])}));if(0===n.length)return"";return n.reduce((function(t,e){return e[0]&&e[1]?(t?t+"&":"")+e.join("="):t}),"")}(i,e);return a?E(r,a):r}function E(t,e){return t.includes("?")?t+"&"+e:t+"?"+e}function j(t){return t.includes("#")?t.slice(0,t.indexOf("#")):t}function O(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function q(t,e,n){return t?w(t,e,n):j(t)}var x=function(){function t(){this.interceptors=[]}return t.prototype.use=function(t,e){return this.interceptors.push({fulfilled:t,rejected:e}),this.interceptors.length-1},t.prototype.eject=function(t){this.interceptors[t]&&(this.interceptors[t]=null)},t.prototype.forEach=function(t){this.interceptors.forEach((function(e){"function"==typeof t&&null!==e&&t(e)}))},t}();function k(t,e){var n=e||{},r=Object.create(null),o=["url","method","data"],i=["headers","params"],u=["validateStatus"];function l(e){var o=t[e],i=n[e];a(i)?a(o)||(r[e]=p(void 0,o)):r[e]=p(o,i)}function p(t,e){return s(t)&&s(e)?f(t,e):s(e)?f({},e):h(e)}function h(t){return Array.isArray(t)||s(t)?f(t):t}o.forEach((function(t){var e=n[t];if(a(e))return;r[t]=h(e)})),["baseURL","transformConfig","transformRequest","transformResponse","paramsSerializer","timeout","adapter","responseType","xsrfCookieName","xsrfHeaderName","cancelToken"].forEach((function(e){var o=n[e];if(!a(o))return void(r[e]=h(o));a(t[e])||(r[e]=h(t[e]))})),u.forEach((function(e){if(e in n)return void(r[e]=h(n[e]));e in t&&(r[e]=h(t[e]))})),i.forEach(l);var d=o.concat(i).concat(u).concat(i);return c(Object.keys(t).concat(Object.keys(n)).filter((function(t){return!d.includes(t)})),l),r}var S="miniRequest:cookies";function A(t){try{var e=wx.getStorageSync(S);return e&&t&&l(e[t])?e[t]:""}catch(t){return console.error(t),""}}function N(t,e){var n={};if(!s(t))return n;if(0===e.length)return t;var r={};return e.forEach((function(t){r[t.toUpperCase()]=t})),Object.keys(t).forEach((function(e){var o=e.toUpperCase(),i=r[o];n[i||e]=t[e]})),n}function M(t,e){if(!t)return{};var n=f(t.common,t[e.toLowerCase()],t);return["delete","get","post","head","patch","put","options","common"].forEach((function(t){delete n[t]})),n}function P(t,e){return e||"0"===String(e)?t+"="+e:t}function U(t,e){var n=t;return c(e,(function(e){"function"==typeof e&&(n=e(t))})),function(t){return t?Array.isArray(t)?f([],t):f({},t):{}}(n)}function W(t,e,n){var r=t;return c(n,(function(n){"function"==typeof n&&(r=n(t,e))})),r}var I=decodeURIComponent,D=/; */;function K(t,e){return void 0===e&&(e={}),t?function(t,e){void 0===e&&(e={});if("string"!=typeof t)return{};var n={},r=t.split(D),o=e.decode||I;return r.forEach((function(t){var e=t.indexOf("=");if(!(e<0)){var r=t.substr(0,e).trim(),i=t.substr(e+1,t.length).trim();'"'===i[0]&&(i=i.slice(1,-1)),a(n[r])&&(n[r]=function(t,e){try{return e(t)}catch(e){return t}}(i,o))}})),n}(t,e):{}}var L=function(t,e,n,r,o){this.extra=null,this.errMsg=t,this.config=e,this.status=n,this.response=r,this.extra=o};function _(t,e,n,r,o){return new L(t,e,n||0===n?n:"NETWORK_ERROR",r,o)}function z(t){return n(this,void 0,void 0,(function(){var n,o,i,u;return r(this,(function(r){switch(r.label){case 0:n=function(t){G(t);var n=t.baseURL,r=t.url,o=t.params,i=q(T(r)?r:R(n,r),o,t.paramsSerializer),u=function(t){return t&&"string"==typeof t?t.toUpperCase():"GET"}(t.method),a=e(e({},t),{headers:M(t.headers,u)});a.data=W(a.data,a.headers,a.transformRequest),a.headers=function(t,e){var n=N(Object.assign(t||{}),["Content-Type"]);return s(e)&&!n["Content-Type"]&&(n["Content-Type"]="application/json; charset=utf-8"),null==e&&delete n["Content-Type"],n}(a.headers,a.data);var c=function(t){return t.withCredentials,function(t,e){if(!e&&String(e)!==String(0))return t;var n=A(e);return l(t)?t+"; "+P(e,n):n||"0"===String(n)?""+P(e,n):e}(t.headers.Cookies,t.xsrfCookieName);return""}(a=U(a,t.transformConfig));c&&(a.headers.Cookies=c);var f=A(a.xsrfCookieName);f&&(a.headers[a.xsrfHeaderName]=f);return e(e({},a),{url:i,method:u,headers:a.headers,getRequestTask:H(a.getRequestTask)})}(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.adapter(n)];case 2:return o=r.sent(),G(n),s(o.headers)&&(o.cookies=K(N(o.headers,["Set-Cookie"])["Set-Cookie"])),t.autoCookies&&function(t){if(t&&s(t))try{var e=wx.getStorageSync(S);wx.setStorageSync(S,f(e,t))}catch(t){console.error(t)}}(o.cookies),"function"==typeof t.validateStatus&&t.validateStatus(o.status)?(o.data=W(o.data,o.headers,n.transformResponse),[2,o]):[2,Promise.reject(_("Request failed with status code "+o.status,o.config,o.status,o))];case 3:return h(i=r.sent())?[2,Promise.reject(i)]:(G(n),(u=i)&&u.response&&(u.response.data=W(u.response.data,u.response.headers,n.transformResponse)),[2,Promise.reject(_(u.errMsg,u.config,u.status,u.response,u.extra))]);case 4:return[2]}}))}))}function G(t){t.cancelToken&&t.cancelToken.throwIfRequested()}function H(t){return"function"==typeof t?t:function(){}}var X=function(){function t(e){this.AppletsRequest=t,this.CancelToken=i,this.isCancel=h,this.defaults={},this.isTimeout=C,this.isNetworkError=b,e&&(this.defaults=e),this.interceptors={request:new x,response:new x}}return t.prototype.request=function(t,e){var n={};"string"==typeof t?(n=this.transformConfig(e)).url=t:n=t,n=k(this.defaults,n);var r=[{fulfilled:z,rejected:void 0}];this.interceptors.request.forEach((function(t){return r.unshift(t)})),this.interceptors.response.forEach((function(t){return r.push(t)}));var o=Promise.resolve(n);return r.forEach((function(t){t&&(o=o.then(t.fulfilled,t.rejected))})),o},t.prototype.get=function(t,e){return this.requestWithMethod(t,"GET",e)},t.prototype.delete=function(t,e){return this.requestWithMethod(t,"DELETE",e)},t.prototype.head=function(t,e){return this.requestWithMethod(t,"HEAD",e)},t.prototype.options=function(t,e){return this.requestWithMethod(t,"OPTIONS",e)},t.prototype.post=function(t,e,n){return this.requestWithData(t,"POST",e,n)},t.prototype.put=function(t,e,n){return this.requestWithData(t,"PUT",e,n)},t.prototype.create=function(e){var n=new t(k(m,e));return function(t,e){if(l(e))return t;for(var n in e)t[n]=e[n];return t}(t.prototype.request.bind(n),n)},t.prototype.all=function(t){if(0===t.length)throw new TypeError("arguments length is 0");return Promise.all(t)},t.prototype.getUri=function(t){var e=t.url,n=t.baseURL,r=t.params,o=e||"";return q(T(o)?o:R(n||"",o),r,t.paramsSerializer)},t.prototype.requestWithMethod=function(t,n,r){return this.request(e(e({},this.transformConfig(r)),{url:t,method:n}))},t.prototype.requestWithData=function(t,n,r,o){return this.requestWithMethod(t,n,e(e({},this.transformConfig(o)),{data:r}))},t.prototype.transformConfig=function(t){return s(t)?t:{}},t}();function F(t){return new X(t).create(t)}var J=F();t.AppletsRequest=X,t.createAppletsRequestInstance=F,t.default=J,Object.defineProperty(t,"__esModule",{value:!0})}));//# sourceMappingURL=mini-request.min.js.map
