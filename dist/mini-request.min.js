!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).appletsRequest={})}(this,(function(e){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var t=function(){return(t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e,t,r,n){return new(r||(r=Promise))((function(o,i){function u(e){try{a(n.next(e))}catch(e){i(e)}}function s(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,s)}a((n=n.apply(e,t||[])).next())}))}function n(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var o=function(){function e(e){this.message="",this.isCancel=!0,this.message=e}return e.prototype.toString=function(){return"Cancel: "+(this.message||"")},e}(),i=function(){function e(e){var t=this;this.promiseResolve=function(){},this.promise=new Promise((function(e){t.promiseResolve=e})),"function"==typeof e&&e(this.cancel.bind(this))}return e.source=function(){var t=function(){};return{token:new e((function(e){t=e})),cancel:t}},e.prototype.cancel=function(e){this.reason||(this.reason=new o(e),this.promiseResolve(this.reason))},e.prototype.execAbort=function(e){return this.promise.then(e)},e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e}();function u(e){return Object.prototype.toString.call(e)}function s(e){if(null===e||"[object Object]"!==u(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function a(e){return void 0===e}function c(e,t){if(null!=e){var r=e;"object"!=typeof e&&(r=[e]),Array.isArray(r)?r.forEach((function(r,n){t.call(null,r,n,e)})):Object.keys(r).forEach((function(e){t.call(null,r[e],e,r)}))}}function f(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return Object.create(null);var r=Object.create(null);function n(e,t){s(r[t])&&s(e)?r[t]=f(r[t],e):s(e)?r[t]=f({},e):Array.isArray(e)?r[t]=f(e):r[t]=e}return r=Array.isArray(e[0])?[]:Object.create(null),e.forEach((function(e){c(e,n)})),r}function l(e){return"string"==typeof e}function p(e){return"function"==typeof e}function h(e){return!a(e)&&(e&&e.isCancel)}function d(e){function r(e){if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(t){return e}}return new Promise((function(n,o){var i,u,s=e.Adapter,c=function(e){var t={url:e.url||"",method:e.method,data:e.data,header:e.headers,dataType:"json",timeout:e.timeout},r=e.dataType||"json";return t.dataType=r,e.responseType&&"json"!==e.responseType&&(t.dataType="其他"),t}(e),l=((u=f({},i=c)).headers=i.header,delete u.header,delete u.Adapter,u);if(!s)throw new TypeError("Adapter is undefined or null");var p=new s(l),h=wx.request(t(t({},c),{success:function(e){p.resolve(function(e){return a(e)||null===e?{headers:{},status:200,data:{},response:e}:{headers:e.header,status:e.statusCode,data:r(e.data),response:e}}(e),n)},fail:function(e){var t=function(e,t){return e&&(e.errMsg||"").toString().toLowerCase().includes("timeout")?{msg:"Timeout of "+(t||"")+" ms exceeded",type:"TIMEOUT"}:{msg:"Network Error",type:"NETWORK_ERROR"}}(e,c.timeout),r={errMsg:t.msg,status:t.type,extra:e};p.reject(r,o)},complete:function(){h=null}}));p.cancel((function(e){o(e),h.abort(),h=null})),"function"==typeof e.getRequestTask&&e.getRequestTask(h)}))}function y(e,t){t&&c(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}var v,g={adapter:!a(wx)&&p(wx.request)?d:Promise.resolve,method:"GET",timeout:1e4,headers:t({common:{Accept:"application/json, text/plain, */*"}},(v={},["delete","get","head","options"].forEach((function(e){v[e]={}})),["post","put","patch"].forEach((function(e){v[e]={"Content-Type":"application/x-www-form-urlencoded"}})),v)),transformConfig:[],transformRequest:[function(e,t){return y(t,"Accept"),y(t,"Content-Type"),s(e)&&function(e,t){!a(e)&&e&&a(e["Content-Type"])&&(e["Content-Type"]=t)}(t,"application/json; charset=utf-8"),e}],transformResponse:[],xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",validateStatus:function(e){return e>=200&&e<300}};var m="miniRequest:cookies";function C(e){return!a(e)&&null!==e&&"NETWORK_ERROR"===e.status}function b(e){return!a(e)&&null!==e&&"TIMEOUT"===e.status}function R(e,t){var r=e||"",n=t||"";return n?r.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):r}function T(e){return/^([a-z][a-z\d+-.]*:)?\/\//i.test(e||"")}function w(e,t,r){var n=j(e);if("string"==typeof t)return E(n,t);var o,i=Object.keys(null===(o=t)||"object"!=typeof o?{}:t);if(0===i.length&&!p(r))return n;var a=p(r)?null==r?void 0:r(t):function(e,t){var r=e.filter((function(e){return function(e){if(null==e)return!1;return!0}(t[e])})).map((function(e){return function(e,t){if(Array.isArray(t))return function(e,t){var r=t.map((function(t,r){return 0===r?t:k(e+"[]")+"="+k(t)}));return[k(e+"[]"),r.join("&")]}(e,t);if(function(e){return"[object Date]"===u(e)}(t))return[k(e),k(t.toISOString())];if(s(t))return[k(e),k(JSON.stringify(t))];return[e,t]}(e,t[e])}));if(0===r.length)return"";return r.reduce((function(e,t){return t[0]&&t[1]?(e?e+"&":"")+t.join("="):e}),"")}(i,t);return a?E(n,a):n}function E(e,t){return e.includes("?")?e+"&"+t:e+"?"+t}function j(e){return e.includes("#")?e.slice(0,e.indexOf("#")):e}function k(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function q(e,t,r){return e?w(e,t,r):j(e)}var O=function(){function e(){this.interceptors=[]}return e.prototype.use=function(e,t){return this.interceptors.push({fulfilled:e,rejected:t}),this.interceptors.length-1},e.prototype.eject=function(e){this.interceptors[e]&&(this.interceptors[e]=null)},e.prototype.forEach=function(e){this.interceptors.forEach((function(t){"function"==typeof e&&null!==t&&e(t)}))},e}();function x(e,t){var r=t||{},n=Object.create(null),o=["url","method","data"],i=["headers","params"],u=["validateStatus"];function l(t){var o=e[t],i=r[t];a(i)?a(o)||(n[t]=p(void 0,o)):n[t]=p(o,i)}function p(e,t){return s(e)&&s(t)?f(e,t):s(t)?f({},t):h(t)}function h(e){return Array.isArray(e)||s(e)?f(e):e}o.forEach((function(e){var t=r[e];if(a(t))return;n[e]=h(t)})),["baseURL","transformConfig","transformRequest","transformResponse","paramsSerializer","timeout","adapter","responseType","xsrfCookieName","xsrfHeaderName","cancelToken"].forEach((function(t){var o=r[t];if(!a(o))return void(n[t]=h(o));a(e[t])||(n[t]=h(e[t]))})),u.forEach((function(t){if(t in r)return void(n[t]=h(r[t]));t in e&&(n[t]=h(e[t]))})),i.forEach(l);var d=o.concat(i).concat(u).concat(i);return c(Object.keys(e).concat(Object.keys(r)).filter((function(e){return!d.includes(e)})),l),n}function S(e,t){var r={};if(!s(e))return r;if(0===t.length)return e;var n={};return t.forEach((function(e){n[e.toUpperCase()]=e})),Object.keys(e).forEach((function(t){var o=t.toUpperCase(),i=n[o];r[i||t]=e[t]})),r}function A(e,t){if(!e)return{};var r=f(e.common,e[t.toLowerCase()],e);return["delete","get","post","head","patch","put","options","common"].forEach((function(e){delete r[e]})),r}function N(e,t){if(!t&&String(t)!==String(0))return e;var r=function(e){try{var t=wx.getStorageSync("miniRequest:cookies");return t&&e&&l(t[e])?t[e]:""}catch(e){return console.error(e),""}}(t);return l(e)?e+"; "+M(t,r):r||"0"===String(r)?""+M(t,r):t}function M(e,t){return t||"0"===String(t)?e+"="+t:e}function P(e,t){var r=e;return c(t,(function(t){"function"==typeof t&&(r=t(e))})),function(e){return e?Array.isArray(e)?f([],e):f({},e):{}}(r)}function U(e,t,r){var n=e;return c(r,(function(r){"function"==typeof r&&(n=r(e,t))})),n}var W=decodeURIComponent,I=/; */;function D(e,t){return void 0===t&&(t={}),e?function(e,t){void 0===t&&(t={});if("string"!=typeof e)return{};var r={},n=e.split(I),o=t.decode||W;return n.forEach((function(e){var t=e.indexOf("=");if(!(t<0)){var n=e.substr(0,t).trim(),i=e.substr(t+1,e.length).trim();'"'===i[0]&&(i=i.slice(1,-1)),a(r[n])&&(r[n]=function(e,t){try{return t(e)}catch(t){return e}}(i,o))}})),r}(e,t):{}}var K=function(e,t,r,n,o){this.extra=null,this.errMsg=e,this.config=t,this.status=r,this.response=n,this.extra=o};function L(e,t,r,n,o){return new K(e,t,r||0===r?r:"NETWORK_ERROR",n,o)}var _=function(){function e(e){this.reqConfig=e}return e.prototype.resolve=function(e,t){(a(e)||null===e)&&t({headers:{},status:200,data:{},config:this.reqConfig,originalRes:null}),t({headers:e.headers,config:this.reqConfig,data:e.data,status:e.status,originalRes:a(e.response)?null:e.response})},e.prototype.reject=function(e,t){(a(e)||null===e)&&t({status:"NETWORK_ERROR",errMsg:"Reject arguments Error",config:this.reqConfig,extra:null}),t({config:this.reqConfig,status:e.status,data:e.data,errMsg:e.errMsg,extra:a(e.extra)?null:e.extra})},e.prototype.cancel=function(e){this.reqConfig.cancelToken&&this.reqConfig.cancelToken.execAbort((function(t){e(t)}))},e}();function z(e){return r(this,void 0,void 0,(function(){var r,o,i,u;return n(this,(function(n){switch(n.label){case 0:r=function(e){G(e);var r=e.baseURL,n=e.url,o=e.params,i=q(T(n)?n:R(r,n),o,e.paramsSerializer),u=function(e){return e&&"string"==typeof e?e.toUpperCase():"GET"}(e.method),a=t(t({},e),{headers:A(e.headers,u)});a.data=U(a.data,a.headers,a.transformRequest),a.headers=function(e,t){var r=S(Object.assign(e||{}),["Content-Type"]);return s(t)&&!r["Content-Type"]&&(r["Content-Type"]="application/json; charset=utf-8"),null==t&&delete r["Content-Type"],r}(a.headers,a.data);var c=function(e){return e.withCredentials,N(e.headers.Cookies,e.xsrfCookieName);return""}(a=P(a,e.transformConfig));c&&(a.headers.Cookies=c);var f=function(e,t){try{return e&&t&&l(e[t])?e[t]:""}catch(e){return console.error(e),""}}(function(e){var t;return p(e.readCookies)?null===(t=e.readCookies)||void 0===t?void 0:t.call(e,m):{}}(e),a.xsrfCookieName);f&&(a.headers[a.xsrfHeaderName]=f);return t(t({},a),{url:i,method:u,headers:a.headers,getRequestTask:H(a.getRequestTask),Adapter:_})}(e),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.adapter(r)];case 2:return o=n.sent(),G(r),s(o.headers)&&(o.cookies=D(S(o.headers,["Set-Cookie"])["Set-Cookie"])),function(e,t){var r;e.autoCookies&&p(e.writeCookies)&&(null===(r=e.writeCookies)||void 0===r||r.call(e,m,t))}(e,o.cookies),"function"==typeof e.validateStatus&&e.validateStatus(o.status)?(o.data=U(o.data,o.headers,r.transformResponse),[2,o]):[2,Promise.reject(L("Request failed with status code "+o.status,o.config,o.status,o))];case 3:return h(i=n.sent())?[2,Promise.reject(i)]:(G(r),(u=i)&&u.response&&(u.response.data=U(u.response.data,u.response.headers,r.transformResponse)),[2,Promise.reject(L(u.errMsg,u.config,u.status,u.response,u.extra))]);case 4:return[2]}}))}))}function G(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function H(e){return"function"==typeof e?e:function(){}}var X=function(){function e(t){this.AppletsRequest=e,this.CancelToken=i,this.isCancel=h,this.defaults={},this.isTimeout=b,this.isNetworkError=C,t&&(this.defaults=t),this.interceptors={request:new O,response:new O}}return e.prototype.request=function(e,t){var r={};"string"==typeof e?(r=this.transformConfig(t)).url=e:r=e,r=x(this.defaults,r);var n=[{fulfilled:z,rejected:void 0}];this.interceptors.request.forEach((function(e){return n.unshift(e)})),this.interceptors.response.forEach((function(e){return n.push(e)}));var o=Promise.resolve(r);return n.forEach((function(e){e&&(o=o.then(e.fulfilled,e.rejected))})),o},e.prototype.get=function(e,t){return this.requestWithMethod(e,"GET",t)},e.prototype.delete=function(e,t){return this.requestWithMethod(e,"DELETE",t)},e.prototype.head=function(e,t){return this.requestWithMethod(e,"HEAD",t)},e.prototype.options=function(e,t){return this.requestWithMethod(e,"OPTIONS",t)},e.prototype.post=function(e,t,r){return this.requestWithData(e,"POST",t,r)},e.prototype.put=function(e,t,r){return this.requestWithData(e,"PUT",t,r)},e.prototype.create=function(t){var r=new e(x(g,t));return function(e,t){if(l(t))return e;for(var r in t)e[r]=t[r];return e}(e.prototype.request.bind(r),r)},e.prototype.all=function(e){if(0===e.length)throw new TypeError("arguments length is 0");return Promise.all(e)},e.prototype.getUri=function(e){var t=e.url,r=e.baseURL,n=e.params,o=t||"";return q(T(o)?o:R(r||"",o),n,e.paramsSerializer)},e.prototype.requestWithMethod=function(e,r,n){return this.request(t(t({},this.transformConfig(n)),{url:e,method:r}))},e.prototype.requestWithData=function(e,r,n,o){return this.requestWithMethod(e,r,t(t({},this.transformConfig(o)),{data:n}))},e.prototype.transformConfig=function(e){return s(e)?e:{}},e}();function F(e){return new X(e).create(e)}var J=F();e.AppletsRequest=X,e.createAppletsRequestInstance=F,e.default=J,Object.defineProperty(e,"__esModule",{value:!0})}));//# sourceMappingURL=mini-request.min.js.map
